/**!
* FixMyPNG: Adds IE6 support: PNG images for CSS background-image and HTML <IMG/>.
* Mender: zhoulf.vasd.sitech
* Example usage:
* FixMyPNG.fix('.png_bg'); // argument is a CSS selector
* FixMyPNG.fix('.png_bg,.png_bg a:hover');
* FixMyPNG.fixPng( someNode ); // argument is an HTMLDomElement
**/

/*
PLEASE READ:
Absolutely everything in this script is SILLY.  I know this.  IE's rendering of certain pixels doesn't make sense, so neither does this code!
*/
;(function(){window.FixMyPNG={ns:"FixMyPNG",imgSize:{},delay:10,nodesFixed:0,createVmlNameSpace:function(){if(document.namespaces&&!document.namespaces[this.ns]){document.namespaces.add(this.ns,"urn:schemas-microsoft-com:vml")}},createVmlStyleSheet:function(){var c,b;c=document.createElement("style");c.setAttribute("media","screen");document.documentElement.firstChild.insertBefore(c,document.documentElement.firstChild.firstChild);if(c.styleSheet){c=c.styleSheet;c.addRule(this.ns+"\\:*","{behavior:url(#default#VML)}");c.addRule(this.ns+"\\:shape","position:absolute;");c.addRule("img."+this.ns+"_sizeFinder","behavior:none; border:none; position:absolute; z-index:-1; top:-10000px; visibility:hidden;");this.screenStyleSheet=c;b=document.createElement("style");b.setAttribute("media","print");document.documentElement.firstChild.insertBefore(b,document.documentElement.firstChild.firstChild);b=b.styleSheet;b.addRule(this.ns+"\\:*","{display: none !important;}");b.addRule("img."+this.ns+"_sizeFinder","{display: none !important;}")}},readPropertyChange:function(){var c,d,b;c=event.srcElement;if(!c.vmlInitiated){return}if(event.propertyName.search("background")!=-1||event.propertyName.search("border")!=-1){FixMyPNG.applyVML(c)}if(event.propertyName=="style.display"){d=(c.currentStyle.display=="none")?"none":"block";for(b in c.vml){if(c.vml.hasOwnProperty(b)){c.vml[b].shape.style.display=d}}}if(event.propertyName.search("filter")!=-1){FixMyPNG.vmlOpacity(c)}},vmlOpacity:function(c){if(c.currentStyle.filter.search("lpha")!=-1){var b=c.currentStyle.filter;b=parseInt(b.substring(b.lastIndexOf("=")+1,b.lastIndexOf(")")),10)/100;c.vml.color.shape.style.filter=c.currentStyle.filter;c.vml.image.fill.opacity=b}},handlePseudoHover:function(b){setTimeout(function(){FixMyPNG.applyVML(b)},1)},fix:function(b){if(this.screenStyleSheet){var d,c;d=b.split(",");for(c=0;c<d.length;c++){this.screenStyleSheet.addRule(d[c],"behavior:expression(FixMyPNG.fixPng(this))")}}},applyVML:function(b){b.runtimeStyle.cssText="";this.vmlFill(b);this.vmlOffsets(b);this.vmlOpacity(b);if(b.isImg){this.copyImageBorders(b)}},attachHandlers:function(i){var d,c,g,e,b,f;d=this;c={resize:"vmlOffsets",move:"vmlOffsets"};if(i.nodeName=="A"){e={mouseleave:"handlePseudoHover",mouseenter:"handlePseudoHover",focus:"handlePseudoHover",blur:"handlePseudoHover"};for(b in e){if(e.hasOwnProperty(b)){c[b]=e[b]}}}for(f in c){if(c.hasOwnProperty(f)){g=function(){d[c[f]](i)};i.attachEvent("on"+f,g)}}i.attachEvent("onpropertychange",this.readPropertyChange)},giveLayout:function(b){b.style.zoom=1;if(b.currentStyle.position=="static"){b.style.position="relative"}},copyImageBorders:function(c){var d,b;d={borderStyle:true,borderWidth:true,borderColor:true};for(b in d){if(d.hasOwnProperty(b)){c.vml.color.shape.style[b]=c.currentStyle[b]}}},vmlFill:function(f){if(!f.currentStyle){return}else{var e,g,h,c,b,d;e=f.currentStyle}for(c in f.vml){if(f.vml.hasOwnProperty(c)){f.vml[c].shape.style.zIndex=e.zIndex}}f.runtimeStyle.backgroundColor="";f.runtimeStyle.backgroundImage="";g=true;if(e.backgroundImage!="none"||f.isImg){if(!f.isImg){f.vmlBg=e.backgroundImage;f.vmlBg=f.vmlBg.substr(5,f.vmlBg.lastIndexOf('")')-5)}else{f.vmlBg=f.src}h=this;if(!h.imgSize[f.vmlBg]){b=document.createElement("img");h.imgSize[f.vmlBg]=b;b.className=h.ns+"_sizeFinder";b.runtimeStyle.cssText="behavior:none; position:absolute; left:-10000px; top:-10000px; border:none; margin:0; padding:0;";d=function(){this.width=this.offsetWidth;this.height=this.offsetHeight;h.vmlOffsets(f)};b.attachEvent("onload",d);b.src=f.vmlBg;b.removeAttribute("width");b.removeAttribute("height");document.body.insertBefore(b,document.body.firstChild)}f.vml.image.fill.src=f.vmlBg;g=false}f.vml.image.fill.on=!g;f.vml.image.fill.color="none";f.vml.color.shape.style.backgroundColor=e.backgroundColor;f.runtimeStyle.backgroundImage="none";f.runtimeStyle.backgroundColor="transparent"},vmlOffsets:function(e){var i,o,d,f,h,n,g,m,k,j,l;i=e.currentStyle;o={W:e.clientWidth+1,H:e.clientHeight+1,w:this.imgSize[e.vmlBg].width,h:this.imgSize[e.vmlBg].height,L:e.offsetLeft,T:e.offsetTop,bLW:e.clientLeft,bTW:e.clientTop};d=(o.L+o.bLW==1)?1:0;f=function(b,p,q,c,r,s){b.coordsize=c+","+r;b.coordorigin=s+","+s;b.path="m0,0l"+c+",0l"+c+","+r+"l0,"+r+" xe";b.style.width=c+"px";b.style.height=r+"px";b.style.left=p+"px";b.style.top=q+"px"};f(e.vml.color.shape,(o.L+(e.isImg?0:o.bLW)),(o.T+(e.isImg?0:o.bTW)),(o.W-1),(o.H-1),0);f(e.vml.image.shape,(o.L+o.bLW),(o.T+o.bTW),(o.W),(o.H),1);h={X:0,Y:0};if(e.isImg){h.X=parseInt(i.paddingLeft,10)+1;h.Y=parseInt(i.paddingTop,10)+1}else{for(k in h){if(h.hasOwnProperty(k)){this.figurePercentage(h,o,k,i["backgroundPosition"+k])}}}e.vml.image.fill.position=(h.X/o.W)+","+(h.Y/o.H);n=i.backgroundRepeat;g={T:1,R:o.W+d,B:o.H,L:1+d};m={X:{b1:"L",b2:"R",d:"W"},Y:{b1:"T",b2:"B",d:"H"}};if(n!="repeat"||e.isImg){j={T:(h.Y),R:(h.X+o.w),B:(h.Y+o.h),L:(h.X)};if(n.search("repeat-")!=-1){l=n.split("repeat-")[1].toUpperCase();j[m[l].b1]=1;j[m[l].b2]=o[m[l].d]}if(j.B>o.H){j.B=o.H}e.vml.image.shape.style.clip="rect("+j.T+"px "+(j.R+d)+"px "+j.B+"px "+(j.L+d)+"px)"}else{e.vml.image.shape.style.clip="rect("+g.T+"px "+g.R+"px "+g.B+"px "+g.L+"px)"}},figurePercentage:function(e,d,g,b){var c,f;f=true;c=(g=="X");switch(b){case"left":case"top":e[g]=0;break;case"center":e[g]=0.5;break;case"right":case"bottom":e[g]=1;break;default:if(b.search("%")!=-1){e[g]=parseInt(b,10)/100}else{f=false}}e[g]=Math.ceil(f?((d[c?"W":"H"]*e[g])-(d[c?"w":"h"]*e[g])):parseInt(b,10));if(e[g]%2===0){e[g]++}return e[g]},fixPng:function(d){d.style.behavior="none";var h,c,g,b,f;if(d.nodeName=="BODY"||d.nodeName=="TD"||d.nodeName=="TR"){return}d.isImg=false;if(d.nodeName=="IMG"){if(d.src.toLowerCase().search(/\.png$/)!=-1){d.isImg=true;d.style.visibility="hidden"}else{return}}else{if(d.currentStyle.backgroundImage.toLowerCase().search(".png")==-1){return}}h=FixMyPNG;d.vml={color:{},image:{}};c={shape:{},fill:{}};for(b in d.vml){if(d.vml.hasOwnProperty(b)){for(f in c){if(c.hasOwnProperty(f)){g=h.ns+":"+f;d.vml[b][f]=document.createElement(g)}}d.vml[b].shape.stroked=false;d.vml[b].shape.appendChild(d.vml[b].fill);d.parentNode.insertBefore(d.vml[b].shape,d)}}d.vml.image.shape.fillcolor="none";d.vml.image.fill.type="tile";d.vml.color.fill.on=false;h.attachHandlers(d);h.giveLayout(d);h.giveLayout(d.offsetParent);d.vmlInitiated=true;h.applyVML(d)}};try{document.execCommand("BackgroundImageCache",false,true)}catch(a){}FixMyPNG.createVmlNameSpace();FixMyPNG.createVmlStyleSheet()})();
